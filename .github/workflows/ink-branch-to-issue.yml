name: Link Branch to Issue Development

on:
  push:
    branches:
      - 'issue-*'

jobs:
  link_branch_to_issue:
    runs-on: ubuntu-latest
    steps:
      - name: Extract Issue Number
        id: extract_issue
        run: |
          ISSUE_NUMBER=$(echo "${{ github.ref }}" | grep -oP 'issue-\K[0-9]+')
          echo "ISSUE_NUMBER=$ISSUE_NUMBER" >> $GITHUB_ENV

      - name: Link branch to issue
        if: env.ISSUE_NUMBER != ''
        run: |
          curl -X POST \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${{ github.repository }}/issues/${{ env.ISSUE_NUMBER }}/development \
            -d '{"reference": {"name": "'${{ github.ref_name }}'", "ref_type": "branch", "url": "https://github.com/'${{ github.repository }}'/tree/'${{ github.ref_name }}'"}}'
